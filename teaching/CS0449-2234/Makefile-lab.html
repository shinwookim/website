<!DOCTYPE html>
<html lang="en">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!-- Metadata -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Makefile Tutorial | Shinwoo Kim</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="Makefile Tutorial">
<meta name="author" content="Shinwoo Kim">
<meta property="og:locale" content="en_US">
<meta name="description" content="Shinwoo Kim is a MS student studying Computer Science at the University of Pittsburgh.">
<meta property="og:description" content="Shinwoo Kim is a MS student studying Computer Science at the University of Pittsburgh.">
<link rel="canonical" href="https://sites.pitt.edu/~shk148/teaching/CS0449-2234/Makefile-lab.html">
<meta property="og:url" content="https://sites.pitt.edu/~shk148/teaching/CS0449-2234/Makefile-lab.html">
<meta property="og:site_name" content="Shinwoo Kim">
<meta property="og:image" content="https://lp-cms-production.imgix.net/2019-06/b620bbff71a0adb8fd86ee311fdba089-cathedral-of-learning.jpg">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta property="twitter:image" content="https://lp-cms-production.imgix.net/2019-06/b620bbff71a0adb8fd86ee311fdba089-cathedral-of-learning.jpg">
<meta property="twitter:title" content="Makefile Tutorial">
<meta name="twitter:site" content="@_shinwookim">
<meta name="twitter:creator" content="@Shinwoo Kim">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Shinwoo Kim"},"description":"Shinwoo Kim is a MS student studying Computer Science at the University of Pittsburgh.","headline":"Makefile Tutorial","image":"https://lp-cms-production.imgix.net/2019-06/b620bbff71a0adb8fd86ee311fdba089-cathedral-of-learning.jpg","url":"https://sites.pitt.edu/~shk148/teaching/CS0449-2234/Makefile-lab.html"}</script>
<!-- End Jekyll SEO tag -->

<!-- End Metadata -->

  <!-- Styles -->
<link rel="stylesheet" type="text/css" href="/~shk148/assets/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="/~shk148/assets/css/main.css">
<link rel="stylesheet" type="text/css" href="/~shk148/assets/css/fonts-et-book.css">
<link rel="stylesheet" type="text/css" href="/~shk148/assets/css/fonts-autography.css">

<link rel="stylesheet" type="text/css" href="/~shk148/assets/css/lightbox.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer">

<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/~shk148/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/~shk148/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/~shk148/assets/favicon/favicon-16x16.png">
<link rel="icon" type="image/x-icon" sizes="32x32" href="/~shk148/assets/favicon/favicon.ico">
<link rel="manifest" href="/~shk148/assets/favicon/manifest.json">

<!-- End Styles-->

<!-- <link rel="stylesheet" type="text/css" href="/~shk148/assets/css/fonts-lato.css" /> -->
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["$$","$$"],["\\[","\\]"]]},"svg":{"fontCache":"global"}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <button type="button" class="toggle-theme" id="color-selecter"></button>
  <section>
  <p class="mb-0">
    
    <a href=".."><em>← Back to Home</em></a>
    
  </p>
</section>
<article style="box-sizing: inherit;">
  <h1 class="title">Makefile Tutorial</h1>
  <p class="subtitle">CS 0449: Introduction to System Software</p>
  <p class="byline">
     
  </p>
  <h2 id="background">
  
  
    Background <a href="#background" class="anchor-link">¶</a>
  
  
</h2>
    
<p><label for="credit" class="margin-toggle"> †</label><input type="checkbox" id="credit" class="margin-toggle" checked><span class="marginnote">Tutorial adapted from <a href="https://people.cs.pitt.edu/~jmisurda/">Dr. Jonathan Misurda</a>’s CS0449 <a href="https://cs0449.gitlab.io/sp2023/resources/worksheets/makefiles/makefiles.pdf">Makefiles Lab</a></span>
Up to this point, you’ve been writing your entire program in a single file. However, that is not something very practical. Good programing practices suggest that you should group similar code (such as all of your code for data structures) into their own files. This improves the readbility of your code, keeps it neat, and ultimately makes it easier to debug.</p>

<p>In this tutorial, you will learn how to manage a project that is split up across several files. As you’ve seen in lecture, multiple files can be compiled independently and then merged together in a process called <strong>linking</strong>. Technically, these two phases use different tools behind the scenes. However, though, the compilers will often hide that process and invoke it for us.</p>

<p>Here, you will create some utility functions in a separate file and then call them from a main C file. You will learn how to compile each independently, and then learn how to use <strong><code class="language-plaintext highlighter-rouge">make</code></strong> which is a tool which helps us manage and simplify the build process. You should already be familiar with using make from past programming assignments. However, now, you will learn to write your own Makefiles.
<label for="cheatsheet" class="margin-toggle"> †</label><input type="checkbox" id="cheatsheet" class="margin-toggle" checked><span class="marginnote"><a href="Makefiles.html">Makefile Cheat Sheet</a></span></p>
<h2 id="objective">
  
  
    Objective <a href="#objective" class="anchor-link">¶</a>
  
  
</h2>
    
<ul>
  <li>Create a C program (<code class="language-plaintext highlighter-rouge">main.c</code>) which prints out $5!$.</li>
  <li>The logic for $!$ should be defined as a function <code class="language-plaintext highlighter-rouge">factorial(int n)</code> stored in<code class="language-plaintext highlighter-rouge">util.c</code>.</li>
  <li>Your <code class="language-plaintext highlighter-rouge">main.c</code> should <em>link</em> to the <code class="language-plaintext highlighter-rouge">util.c</code>
</li>
  <li>You should create a <code class="language-plaintext highlighter-rouge">Makefile</code> which allows for easy compilation of your program.</li>
</ul>
<h2 id="procedure">
  
  
    Procedure <a href="#procedure" class="anchor-link">¶</a>
  
  
</h2>
    
<ol>
  <li>Login to <code class="language-plaintext highlighter-rouge">thoth.cs.pitt.edu</code> via SSH <label for="step-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="step-1" class="margin-toggle" checked><span class="sidenote"><code class="language-plaintext highlighter-rouge">ssh &lt;username&gt;@thoth.cs.pitt.edu</code> </span>
</li>
  <li>Move into your private directory where you store all your work for this class<label for="step-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="step-2" class="margin-toggle" checked><span class="sidenote"><code class="language-plaintext highlighter-rouge">cd private/DIRECTORY</code> </span>.</li>
  <li>Then, create a directory for this worksheet and navigate to it:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>makefile-lab
<span class="nb">cd </span>makefile-lab
</code></pre></div>    </div>
  </li>
  <li>The first step will be to create our main C file (using the terminal editor of your choice):
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>nano main.c
</code></pre></div>    </div>
  </li>
  <li>Now enter the initial skeleton code:<label for="step-5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="step-5" class="margin-toggle" checked><span class="sidenote">Notice that this program will not do anything meaningful (just yet) </span>
    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
 <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p>and save the file.</p>
  </li>
  <li>We now need to compile this. This is a rather straightforward process since it is just a single file. However we want to compile and link in separate steps for now:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-c</span> main.c
</code></pre></div>    </div>
  </li>
  <li>The “<code class="language-plaintext highlighter-rouge">-c</code>” argument to gcc will create a <code class="language-plaintext highlighter-rouge">main.o</code> object file instead of linking an entire executable. You can see it if you use the <code class="language-plaintext highlighter-rouge">ls</code> command to list the directory. We can now link the object file with the C standard library and create an executable called main by using the following:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-o</span> main main.o
</code></pre></div>    </div>
  </li>
  <li>Now, what if we had another file? Let’s create a <code class="language-plaintext highlighter-rouge">util.c</code> file that contains some functions we would like to use. Create the following file and fill it with the provided code:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>nano util.c
</code></pre></div>    </div>
    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">factorial</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
 <span class="p">{</span>
     <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
 <span class="p">}</span>
 <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>We don’t need to do much inside this C file. However, how do we call it from our <code class="language-plaintext highlighter-rouge">main.c</code> file? Well, it has to know what is defined in <code class="language-plaintext highlighter-rouge">util.c</code>. So, we have to write a separate file that contains a listing of functions and definitions useful to our second file<label for="step-9" class="margin-toggle sidenote-number"></label><input type="checkbox" id="step-9" class="margin-toggle" checked><span class="sidenote">This file is often called a header file as include statements often appear towards the <em>head</em> in source files </span>. So, let’s create a <code class="language-plaintext highlighter-rouge">util.h</code> file:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>nano util.h
</code></pre></div>    </div>
  </li>
  <li>Place this code inside:
    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">factorial</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
</code></pre></div>    </div>

    <p>Notice that this “<strong>header file</strong>” only needs the strict definition of any functions you want to expose to your C files. Here, it suggests that you can call a function named factorial and it will return an <code class="language-plaintext highlighter-rouge">int</code> and takes an <code class="language-plaintext highlighter-rouge">int</code> as input. This is called a <strong>function prototype</strong>. The rest of your code does not need to know the implementation details (such as it being recursive).</p>
  </li>
  <li>Now we can build this file as well: (Notice, we do not do anything with the header file, <code class="language-plaintext highlighter-rouge">util.h</code>)
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-c</span> util.c
</code></pre></div>    </div>
  </li>
  <li>Now let’s modify our <code class="language-plaintext highlighter-rouge">main.c</code> to have it call the factorial function:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>nano main.c
</code></pre></div>    </div>

    <p>And let’s use the following code to have it call the factorial function:</p>

    <div class="language-c highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"util.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1"> //for printf</span><span class="cp">
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
<span class="c1">// Should print 120 to stdout</span>
<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <p>Yes, we <code class="language-plaintext highlighter-rouge">#include</code> the <code class="language-plaintext highlighter-rouge">util.h</code>. This effectively just copies-and-pastes the contents of <code class="language-plaintext highlighter-rouge">util.h</code> into this file. This is why we need the separate files since copying the actual function duplicates the code for the factorial function and multiple versions of a function will cause us grief later on.</p>

    <p>Could we just type the function declaration contained in <code class="language-plaintext highlighter-rouge">util.h</code> into the top of <code class="language-plaintext highlighter-rouge">main.c</code> instead of including the file with the preprocessor? Yes! But it sure is more annoying to change…</p>
  </li>
  <li>Finally, we can re-compile our main function:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-c</span> main.c
</code></pre></div>    </div>
  </li>
  <li>And then re-link our executable (including the code in util!):
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-o</span> main main.o util.o
</code></pre></div>    </div>
    <p>NOTE: why did we not have to re-compile util.c? It did not change! You only have to recompile files that change, which is the power of linking. We will exploit this in our tooling with <code class="language-plaintext highlighter-rouge">make</code>!</p>
  </li>
  <li>However, this gives us an opportunity to do something smarter. A tool called <strong>make</strong> is designed to invoke commands, such as each of the gcc commands above. Furthermore, it can be written to only run commands on files that have changed. Let’s look at the Makefile for our little project so far. <code class="language-plaintext highlighter-rouge">make</code> looks for a particular file in the current directory. Create the file we need here (note the capitalization):
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>nano Makefile
</code></pre></div>    </div>
    <p>Write the following and save the file:</p>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>main: main.o util.o
    gcc -o main main.o util.o
main.o: main.c
    gcc -c main.c
util.o: util.c
    gcc -c util.c
</code></pre></div>    </div>

    <p><strong>NOTE</strong>: It is VERY important that the indentation you use are strictly tabs. That is, you must tab over the “<code class="language-plaintext highlighter-rouge">gcc -c util.c</code>”, etc using your keyboard’s tab key. If you use spaces (or your editor replaces tabs with spaces) you will get errors from Make such as:</p>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>Makefile:2: *** missing separator. Stop.
</code></pre></div>    </div>
  </li>
  <li>Back at your shell, run your makefile by typing this command:
    <div class="language-sh highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>make
</code></pre></div>    </div>
  </li>
</ol>
<h2 id="adding-features-to-makefiles">
  
  
    Adding features to Makefiles <a href="#adding-features-to-makefiles" class="anchor-link">¶</a>
  
  
</h2>
    
<p>Congratulations, You wrote your first Makefile! However, as you have seen in recitation, Makefiles offer a whole lot more features than we’ve just used. Here, we’ll explore how to implement some of them.</p>
<h3 id="make-clean">
  
  
    <code class="language-plaintext highlighter-rouge">make clean</code> <a href="#make-clean" class="anchor-link">¶</a>
  
  
</h3>
    
<p>Makefiles are great because it allows you to re-compile only the modified files (which speeds up compilation time). However, sometimes, you may want to re-compile your entire project from scratch. Sure, you can look through your file explorer to delte all the compiled binaries, and run <code class="language-plaintext highlighter-rouge">make</code> again. But, make offers a simply way to <strong>clean</strong> your compiled files.</p>

<p>Add the following rule to your Makefile:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clean:
        rm -f main main.o util.o
</code></pre></div></div>

<p>With those lines added, you can run <code class="language-plaintext highlighter-rouge">make clean</code> to remove all the compiled files automatically.</p>
<h3 id="using-variables">
  
  
    Using variables <a href="#using-variables" class="anchor-link">¶</a>
  
  
</h3>
    
<p>Often times, when we are compiling, we want to use certain flags. For example, the <code class="language-plaintext highlighter-rouge">-g</code> flag, which preserves debugging symbols, allows our compiled executable to be run via GDB and is particularly useful when programming.</p>

<p>We could modify our Makefiles and add the flags to each rule like:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>main: main.o util.o
        gcc -Wall -g -o main main.o util.o
main.o: main.c
        gcc -Wall -g -c main.c
util.o: util.c
        gcc -Wall -g -c util.c
</code></pre></div></div>
<p>However, typing all that is tedious and modifying it even more so. Instead, we can define a <code class="language-plaintext highlighter-rouge">$(CFLAGS)</code> variable to make it easily modifiable.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CFLAGS := -Wall -g
main: main.o util.o
        gcc $(CFLAGS) -o main main.o util.o
main.o: main.c
        gcc $(CFLAGS) -c main.c
util.o: util.c
        gcc $(CFLAGS) -c util.c
</code></pre></div></div>
<p>Now, if you wanted to drop the <code class="language-plaintext highlighter-rouge">-g</code> flag (for instance, as your code moves to production), you can simply modify the <code class="language-plaintext highlighter-rouge">$(CFLAGS)</code> variable once instead of modifying all the rules.</p>

<p>Similarly, we can use the <code class="language-plaintext highlighter-rouge">$(CC)</code> variable to define the compiler we are using. This can be particularly useful if you are distributing your source to multiple machines running different architecture. The user can simply modify <code class="language-plaintext highlighter-rouge">CC := gcc</code> to <code class="language-plaintext highlighter-rouge">CC := clang</code> to swap out their compiler (There are differences between gcc and clang’s falgs so this is not always guaranteed to work).</p>
<h3 id="more-features">
  
  
    More features <a href="#more-features" class="anchor-link">¶</a>
  
  
</h3>
    
<p>Makefiles offer so much more functionalities (some more useless than others) than what is described here. For instance, automatic variables such as <code class="language-plaintext highlighter-rouge">*</code> wildcards and <code class="language-plaintext highlighter-rouge">%</code> wildcards offer a useful way to compile hundreds or even thousands of files easily. Makefiles even support conditionals, string substitutions, and even functions!</p>

<p><img src="https://malithjayaweera.com/wp-content/uploads/2020/05/makefile_tutorial_2.jpg" alt=""></p>

<p>GNU has an <a href="https://www.gnu.org/software/make/manual/make.html">official documentation</a> on how Makefiles work, however that can be a bit dense to read. <label for="There is also an entire book on Makefiles, but there are better ways to spend your money" class="margin-toggle">†</label><input type="checkbox" id="There is also an entire book on Makefiles, but there are better ways to spend your money" class="margin-toggle"><span class="marginnote"><img class="fullwidth" src="https://img.thriftbooks.com/api/images/m/36188bb7727c0af39dd0175f2919948a871f0a73.jpg"><br></span></p>

<p><a href="https://makefiletutorial.com/">The Makefile Tutorial</a> is another great resource which provide excellent explanations as well as examples on everything you can do with Makefiles (and I mean everything!).</p>

<p>As you become a better programmer and your projects grow in complexity, try to keep in mind great software engineering principles (such as <strong>modularity</strong>) and learn tools (such as <strong>make</strong>) to apply those principles!</p>

</article>
  <div class="container">
	<footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
		<div class=" d-flex align-middle">
			<a class="no-tufte-underline text-md-end fw-bolder autography h3 mx-2" href="/~shk148/">Shinwoo
				Kim</a>
			<span class="mb-3 mb-md-0 text-body-secondary"> © 2020 - 2024,
				<a href="mailto:shinwookim@pitt.edu">Shinwoo Kim</a>. All Rights Reserved.
			</span>

		</div>
		<ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
			<li class="ms-3"><a class="no-tufte-underline" href="https://twitter.com/_shinwookim"><i class="fab fa-twitter"></i></a></li>
			<li class="ms-3"><a class="no-tufte-underline" href="https://github.com/shinwookim"><i class="fab fa-github"></i></a></li>
			<li class="ms-3">
<a class="no-tufte-underline" href="https://linkedin.com/in/kimshinwoo"><i class="fab fa-linkedin-in"></i></a>
			</li>
		</ul>
	</footer>
</div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
<script src="/~shk148/assets/js/darkmode.js"></script>
<script src="/~shk148/assets/js/lightbox.js"></script>
<script data-name="BMC-Widget" data-cfasync="false" src="/~shk148/assets/js/coffee.js" data-id="shinwookim" data-description="Support me on Buy me a coffee!" data-message="" data-color="#fff" data-position="Right" data-x_margin="12" data-y_margin="12"></script>
<script>
  // Enable Bootstrap Tooltips
  // See: https://getbootstrap.com/docs/5.3/components/tooltips/
  const tooltipTriggerList = document.querySelectorAll(
    '[data-bs-toggle="tooltip"]'
  );
  const tooltipList = [...tooltipTriggerList].map(
    (tooltipTriggerEl) => new bootstrap.Tooltip(tooltipTriggerEl)
  );
</script>
</body>

</html>
